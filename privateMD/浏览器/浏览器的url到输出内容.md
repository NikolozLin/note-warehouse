# 浏览器输入URL到页面显示发生了什么

1. URL解析（编码）
2. DNS解析
3. HTTP请求

## URL 编码

- URI（统一资源标志符），URL（统一资源定位符）是一种具体的URI，是URI的一个子集合。在某个规则下能唯一标识资源的就是URI，在其基础上给出资源访问方式的就是URL。  
- 网络标准RFC1738规定，URL只能使用普通字符[0-9a-zA-Z]、特殊字符`$-_.+!*'(),`一些保留字才可以不需要编码直接用于URL。
- 如果URL需要编码油浏览器决定，但是如果在已经打开的页面发送GET或者POST请求，页面的HTML文件有一个`<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">`其中chartset就规定发URL的编码方式。
- 为了解决编码混乱的问题，于是使用JavaScript对URL进行编码后再传输，常用`encodeURI` `encodeURIComponent`，最后输出utf-8编码。
- `encodeURI` `encodeURIComponent`区别
  - `encodeURI()` 不会对下列字符编码： ASCII编码、数字、`- _ . ! ~ * ' ( ) ; , / ? : @ & = + $ #` 进行编码
  - `encodeURIComponent()` 不会对下列字符编码： ASCII编码、数字、`- _ . ! ~ * ' ( )` 进行编码,其他一律转码
  - 两种方法的转义范围不同，当对`整个URL`进行转义时使用`encodeURI()`，单转义后的结果不用请求。如果需要对`URL参数部分`进行编译则使用`encodeURIComponent()`
UTF-8就是为了解决向后兼容ASCII码而设计,这使得原来处理ASCII字符的软件无须或只须做少部分修改，即可继续使用. 最后utf-8成了通用的编码。

## DNS解析

DNS可以将主机域名转换为IP地址
转换整体流程 （www.google.com 为例）

1. 输入URL后，浏览器检测缓存中是否存在域名对应的解析过的`IP地址`，有直接使用缓存的内容。
2. 如果不存在与浏览器缓存，则检查本地的hosts文件是否有该网址的映射，有直接使用。
3. hosts文件中不存在相关映射，则查询本地DNS解析器缓存（可能路由器缓存），有直接使用。
4. 如果hosts文件和本地DNS解析器没有映射关系，会根据`TCP/IP`设置的的首选DNS服务器（本地DNS服务器）进行查询，有查询域名的资源,则返回结果（具有权威性）
5. 查询的地址不由本地DNS服务器区域解析，但缓存中存在相关映射，则返回相关结果(不具有权威性)
6. 本地DNS服务器和服务器的缓存都解析失败，更具本地DNS服务器的设置（时候设置转发器）进行查询
    - 未设置转发(迭代模式)
        1. 本地DNS服务器直接将解析请求发送到 13个`根域名服务器`，根域名服务器收到请求后判断`域名`后谁进行授权管理，然后返回一个负责该顶级域名（.com）服务器的`IP`地址。
        2. 本地DNS服务器收到IP信息后，发送解析请求到该IP的服务器。顶级域名（.com）服务器如果无法解析，则会找到管理（google.com）的二级域名DNS服务器的IP ，返回给本地DNS服务器
        3.重复上面行为 直到找到`www.google.com`
    - 有转发设置（递归模式）
        1. 本地DNS服务器将请求转发到下一级的DNS服务器()，让下一级解析。如果下一级无法解析，则下一级转给下级的服务器。
            > 已递归模式进行解析，如果本地DNS无法解析，转发给根域名服务器让根域名服务器去解析，根没有的话根服务器取找下一级（以此类推）。本地DNS服务器值只发送一次请求。
        2. 直炒查询到结果或者报错。
7. 最后 将解析结果返回给浏览器

### 迭代查询和递归查询

递归： 客户端发送一次请求，要求得到最后的结果
迭代： 客户端发送一次请求，如果它没有授权回答就返回一个能解析的域名服务器，客户端需要重新发出解析请求。重复步骤，直到最终结果

## HTTP请求

# HTTPS

##
