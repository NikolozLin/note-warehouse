# 3d点云数据映射到2d图片

    描述：  
    1. 空间的雷达数据点 投影到相机拍摄的图片（已畸变矫正）
    2. 点击2d图片上的投影形状 关联到 划分的3d语义对象上

## 一、主要功能点拆解  

1. 3d点映射到2d点
2. 编写canvas的互交功能

## 二、实现分析
1. 坐标点换算
    - 了解什么是 世界坐标系、相机坐标系、图像坐标系、像素坐标系的换算关系
        <https://blog.csdn.net/weizhangyjs/article/details/81020177>
        <https://blog.csdn.net/Aoulun/article/details/104780993>
    - 
2. 投影实现
    - 使用canvas载入相机图像，根据换算的像素坐标绘制 ‘3d语义分割点集合’ 在平面图像的映射
3.canvas互交
    - canvas相比svg，canvas不支持事件处理器，需要自己编写事件处理
    - 互交过程视为 点击点位置与图形的形状的碰撞检测

## 一些方案
- 碰撞检测
    - 点与图形 
        - 简单的图像用数学方法计算距离判断是否在图形内、是否在四个角的xy范围内
        - 面积判断： 点与其他顶点相连得到许多小图像，小图形面积和等于大图形则发生碰撞
        - 射线法： 点线点向一个方向发射一条射线如果与图形相交的点个数为奇数 这点在图形内
        - 像素法： 设置一个或多个canvas层, 当主图形绘制时同时在隐藏的canvas层 以绘制的index顺序为颜色绘制相同图形。
    - 多边形与多边形
        - SAT分离轴检测
        - GJK检测
        - 对于复杂图形可以使用包围盒初步判断后进行更具体的检测
## 坑
---
使用像素法判断点与数据  
- 使用 canvasContext.putImageData(imgData,dx,dy)  
- imgData是ctx.createImageData(width,height)设置的像素块。里面的颜色数据以RGBA(0,0,0,0)格式的颜色设定的.
    > 填入数据时会发生“alpha合成”如果设置的RGB通道的值过小会值会丢失!!!!
- alpha合成的颜色计算公式
    >显示颜色= 源像素颜色 X alpha / 255 + 背景颜色 X (255 - alpha) / 255 

